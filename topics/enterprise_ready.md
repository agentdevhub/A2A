# 企业级就绪能力

<!-- TOC -->

- [企业级就绪能力](#企业级就绪能力)
    - [传输层安全性](#传输层安全性)
    - [服务端身份](#服务端身份)
    - [客户端与用户身份](#客户端与用户身份)
    - [客户端认证](#客户端认证)
    - [授权与数据隐私](#授权与数据隐私)
    - [追踪与可观测性](#追踪与可观测性)

<!-- /TOC -->

A2A **不主张**创造新的企业安全标准，而是致力于与现有基础设施无缝集成。

A2A 将企业级 Agent 建模为标准化的 HTTP 企业应用，因此依赖企业级的认证、安全、隐私、追踪和监控体系。这种设计的可行性源于 A2A Agent 的封装特性——它们不共享工具或资源（因此适用"单应用"客户端/服务端的最佳实践）。

实际上，A2A 将大部分企业级关注点从协议中抽离，转而要求基于企业级 HTTP 协议并支持开放式认证（Open Authentication）和开放式追踪（Open Tracing）。实施者应遵循所有与企业应用和用户级安全相关的最佳实践。

## 传输层安全性
A2A 构建于 HTTP 协议之上，任何生产环境部署都应强制使用 HTTPS 并采用现代 TLS 加密套件。

## 服务端身份
A2A 服务端在 TLS 协商过程中，通过知名证书颁发机构签发的数字证书来验证身份。客户端应在建立连接时验证服务端身份。

## 客户端与用户身份
A2A 协议本身不定义用户或客户端标识符，而是通过协议传递认证要求（方案和凭证材料）。客户端负责与认证机构进行协议外协商（out of band），获取并存储凭证材料（如 OAuth 令牌）。这些凭证将通过 HTTP 头传递，而非 A2A 有效载荷。

不同认证协议和服务提供商有不同要求，单个请求可能在特定方案头中包含多个标识符。建议客户端在请求中始终携带两种身份：客户端身份（代表 Agent）和用户身份（代表终端用户）。

**注意**：多身份联合认证是待讨论的开放议题。例如用户 U 使用需要 A 系统标识符的 Agent A 时，若 Agent A 依赖需要 B 系统标识符的 Tool B 或 Agent B，则用户可能需要在单次请求中同时提供 A/B 系统的身份（假设 A 系统是企业 LDAP 身份，B 系统是 SaaS 提供商身份）。

当前建议：若 Agent A 要求用户/客户端为任务某环节提供额外身份，应在 `INPUT-REQUIRED` 状态通过更新消息（包含与 AgentCard 认证要求相同的结构）通知客户端。客户端需在 A2A 和 A 系统之外，与 B 系统的认证机构协商获取凭证材料（如令牌），并通过 Agent A 传递给 Agent B，由 Agent B 与上游系统交互时使用。

## 客户端认证
A2A 服务端应在 [Agent Card](/documentation.md#agent-card) 中声明支持的认证协议（须为标准 [OpenAPI 认证格式](https://swagger.io/docs/specification/v3_0/authentication/)，如 API Keys、OAuth、OIDC 等，也支持客户端与服务端共同认可的其他协议）。

各认证协议有独立的凭证获取、刷新和质询机制（如持有者令牌或会话令牌），这些凭证管理流程属于 A2A 协议外流程。

A2A 服务端应对**每个**请求进行认证，并通过标准 HTTP 响应码（401、403）及协议特定头/体拒绝或质询请求。例如：携带 [WWW-Authenticate](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/WWW-Authenticate) 头的 401 响应（指示所需认证方案），或在固定路径提供 OIDC 发现文档。

## 授权与数据隐私
A2A 服务端应根据用户和应用身份进行双重授权。建议各 Agent 至少从以下两个维度实施访问控制：

* **技能维度**  
Agent 应通过 [Agent Card](/documentation.md#agent-card) 声明其技能集。建议按技能粒度授权（例如：OAuthScope 'foo-read-only' 可限制仅访问 'generateRecipe' 技能）。

* **工具维度（操作与数据）**  
建议通过工具（Tool）封装敏感数据或操作。当智能流程或模型需要访问时，Agent 应根据应用+用户权限进行工具级授权。强烈建议采用 API 管理方案控制工具访问。

## 追踪与可观测性
所有 A2A 请求均为标准 HTTP 请求，客户端和服务端应使用企业标准工具链——自动添加检测头（instrumentation headers），并将事件写入标准日志和事件队列。